---
title: Lab 3
year: CanHap501, Winter 2022
---

{% include title.html %}

{% include media.html img="https://user-images.githubusercontent.com/17170744/153616630-1d2d7fbd-2be9-4a20-b2d7-156ea368323a.png" %}

For Lab 3, I used a node based programming language and environment called TouchDesigner which is used to manipulate real-time multimedia content. Transformations are performed by nodes (rectangular blocks) where the output and/or properties of one node can become the input to another node, nodes are chained together to create a pipeline (reminiscent of functional programming).<br/><br/>I chose to use TouchDesigner because I've found it to be useful for real-time signal processing and has unique features which I thought could be interesting to explore with the Haply. I modified my code from Lab 2 to have Processing send and receive OSC messages to and from a TouchDesigner program, where I do force calculations. Processing sends the device's position and listens for torque data from TouchDesigner.<br/><br/>I started by attempting to build a PID controller in TouchDesigner, which has nodes to calculate derivatives and integrals. I was able to create a controller but unable to reach a stable state after spending a lot of time tweaking the gain values. I speculate there was too much delay when calculate the derivative/integral which create lag in the PID feedback loop between TouchDesigner, Processing, and the Haply. However, the process was very insightful and I felt I understood PID control better from tweaking gain values through TouchDesigners responsive and visual interface.<br/><br/>My original and final words were&#x3a; <ol><li><b>Bird</b> (dynamic object) -> <b>Fly</b> (dynamic object)</li><li><b>String</b> (dynamic object) -> <b>Grate</b> (region)</li><li><b>Handwriting</b> (region)</li></ol> <h3><a href="https://git.uwaterloo.ca/d28chow/canhap501/-/blob/master/lab_3" target="_blank">Link to the code</a> (requires <a href="https://derivative.ca/download" target="_blank">TouchDesigner</a> to open .toe file).</h3> The let image is the TouchDesigner "code" which contains all three movements (switched through keyboard). Below are the movements on the Haply and their corresponding TouchDesigner nodes.

<hr/>
<h2>Movement 1&#x3a; Fly</h2>
Original word&#x3a; <b>Bird</b> -> final word&#x3a; <b>Fly</b>
<br/><br/>
{% include media.html video="https://user-images.githubusercontent.com/17170744/153619844-d0eceb68-bb27-471d-8539-5229917bcd65.mp4" settings="controls" %}

I wanted to convey the movement of a bird in flight because I think it is an interesting combination of locally random but overall focused and smooth movement. I imagined the bird as the end effector. To create the movement I varied the x and y force using sin and cos functions with varying magnitude, frequency, and speed that would change over time, which I combined these with noise functions. I found the final movement to be more jittery and erratic than I expected which is how my word became <b>Fly</b>, which was more characteristic of the final result.<br/><br/>I designed the movement with the user holding onto the end effector in mind. I realize when the user is not holding the effector, the Haply maxes out to the edge of the task space quickly. This helped me understand the usefulness of having PID control.

{% include media.html img="https://user-images.githubusercontent.com/17170744/153616635-57cf6685-f958-4014-bd70-3ca2363b2a1e.png" %}

<hr/>

<h2>Movement 2&#x3a; Grate</h2>
Original word&#x3a; <b>String</b> -> final word&#x3a; <b>Grate</b>
<br/><br/>

{% include media.html video="https://user-images.githubusercontent.com/17170744/153619844-d0eceb68-bb27-471d-8539-5229917bcd65.mp4" settings="controls" %}

I originally wanted to simulate the feeling of plucking a string because I am creating a musical instrument for my group project. I experimented with different wave types (square, sine, triangle) functions and used the end effector's x position to shift their phase. This gave the feeling of "strumming" as the user moved the end effector horizontally.
<br/><br/>
I found using the square wave create an interesting texture and sound that reminded me of running a hard object across a metal grate. I found mapping movement as a function of the x position to be useful in shaping the texture of the force.

{% include media.html img="https://user-images.githubusercontent.com/17170744/153616633-3aa54be2-3234-4e5e-9651-9d0da76efb70.png" %}

<hr/>

<h2>Movement 3&#x3a; Handwriting</h2>
Original and final word&#x3a; <b>Handwriting</b>
<br/><br/>

{% include media.html video="https://user-images.githubusercontent.com/17170744/153619834-13cd5057-5499-46f0-8fa0-e8c0af85b3a3.mp4" settings="controls" %}

I wanted to recreate the feeling of handwriting. I held attached a pen to the end effector to simulate a writing grip, which added realism. I used a sum of sine functions to produce vertical force as a function of the x position, so when the user moved the Haply horizontally, the pen would move up and down. I found adding sine waves of different frequencies helped create a feeling of scribble but with varied rhythm of cursive writing. Similar to Movement 1, without pressing on the pen, the Haply quickly maxed to the edge of the task space.

{% include media.html img="https://user-images.githubusercontent.com/17170744/153616637-c5941fe1-a259-43f8-878d-4b3a663e442d.png" %}

<hr/>

{% include media.html img="https://user-images.githubusercontent.com/17170744/153616631-471d7b5f-c039-49ec-b951-ec2e91913b55.png" %}

Overall I was most satisfied with the <b>Handwriting</b> movement but found the <b>Grate</b> movement to be the most unexpected. Some lessons I learned were the usefulness of periodic shaping functions in producing dynamic and varied textures, which I noticed a similarity to sound synthesis. I found combining these functions and having them be a function of the Haply's position produced more complex and dynamic movements.<br/><br/>With Movements 1 and 3, I noticed by holding onto the end effector, I was acting as a PID controller, stabilizing the system, and part of the feedback loop. This reminds me of the field of Cybernetics where biological and mechanical systems share common processes through feedback loops. I think it is interesting to think of the user as a component of the loop. Although I was disappointed I could not implement PID control in TouchDesigner, it helped me understand feedback control more, which will definitely help me for Lab 4 and my group project. 





